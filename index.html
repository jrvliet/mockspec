<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Mockspec by jrvliet</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Mockspec</h1>
        <p>Full Pipeline</p>
        <p class="view"><a href="https://github.com/jrvliet/mockspec">View the Project on GitHub <small>jrvliet/mockspec</small></a></p>
        <ul>
          <li><a href="https://github.com/jrvliet/mockspec/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/jrvliet/mockspec/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/jrvliet/mockspec">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h2>
<a id="welcome-to-mockspec" class="anchor" href="#welcome-to-mockspec" aria-hidden="true"><span class="octicon octicon-link"></span></a>Welcome to Mockspec</h2>

<p>This is the main page for the mockspec code. This code generates and analyzes synthetic quasar absorption line profiles in the circumgalactic medium around galaxies simulated with ART. It has been developed by <a href="http://astronomy.nmsu.edu/jrvander">Jacob Vander Vliet</a> and <a href="http://astronomy.nmsu.edu/cwc">Dr. Chris Churchill</a> at <a href="astronomy.nmsu.edu">New Mexico State University</a>. The full details of how the code works can be found: <a href="http://adsabs.harvard.edu/abs/2014arXiv1409.0916C">here</a> and <a href="http://adsabs.harvard.edu/abs/2015ApJ...802...10C">here</a>. </p>

<h3>
<a id="overview" class="anchor" href="#overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overview:</h3>

<p>This code generates synthetic quasar absorption lines by running lines of sight (LOS) through a simulated galaxy made with ART.  This repository has all the code required to generate and analyze the spectra. </p>

<h3>
<a id="before-you-run-the-code" class="anchor" href="#before-you-run-the-code" aria-hidden="true"><span class="octicon octicon-link"></span></a>Before you run the code:</h3>

<p>There are a few steps that need to be taken before the code can be run. </p>

<ol>
<li> To run this code, the following python packages need to be installed:
<ul>
<li> numpy
</li>
<li> pytables
</li>
<li> pandas
</li>
</ul>

</li>
<li> Get the simulation in the correct format. ART output the entire simulation box, typically 10Mpc along a side. Mockspec does not run on these boxes. It instead runs on a small box selected from the large box. This selection is done using ANA, a code written by Daniel Ceverino and greatly improved by Kenza Arraki. It is found in funcs/ana/. Running ANA can be challenging. It requires the following simulation files:
<ul>
<li> 10MpcBox_HartGal_csf_a0.300.di
</li>
<li> 10MpcBox_HartGal_csf.d
</li>
<li> PMcrda0.300.DAT
</li>
<li> PMcrs0a0.300.DAT    
</li>
<li> sf.dat
</li>
</ul>
To control the run of ANA, there are two control file: 
<ul>
<li> control.dat 
</li>
<li> schedule_R.dat
</li>
</ul>    
Schedule_R.dat has most of the controls in it. The top section has flags as to what the code should read in and what files it should produce. The sections that definitely need to have a 1 are:
<ul>
<li> Read N-body file
</li>
<li> Read stellar file
</li>
<li> Read HYDRO file
</li>
<li> Set units and global variables
</li>
<li> Find halo center using particle distribution
</li>
<li> Compute angular momentum
</li>
<li> density, temperature, entropy profiles and Rvir calculation
</li>
<li> Binary file with gas cells inside 4Rvir-box
</li>
<li> Binary file with gas cells inside 4Rvir-box (metalliciites)
</li>
</ul>
Most of the rest of the file should not be touched. ANA has an interesting behaviour where it finds the center of the galaxy, but is super bad at it. You need to find the center with Rockstar and put it in manually. The coordinates are put in on the lines "xuser", "yuser", "zuser". The flag in front of "ioptCenter=1/2/3--&gt;potential/HF/IFRIT" should be set to 1, indicating the center is from a halo finder.


To setup control.dat, only change after the three repeated lines of "1. 129". The single number on the next line is the number of snapshots to run ANA on. Leave this as one. The rest of the file is the list of expansion parameters of the snapshots. Even if there are several numbers listed here, ANA will only run on the first one, since the number of snapshots to run is set to 1. 


Once both control.dat and schedule_R.dat are set, run ana.R.exe.  The file needed is the GZ file. The necessary output files are named &lt;galID&gt;_GZa&lt;expansion parameter&gt;.txt (the gas box) and Jacob.txt (summary file). 



</li>
<li> To use the summary file, its contents need to be added to the galaxy's summary file. These files are named &lt;galID&gt;.dat and are located in the summaries directory. These properties are required for the rest of the pipeline, mainly cellfinder, to work. The rotation matrix <em>a</em> is one of the most important results from ANA and the main reason we still use it. 





</li>
<li> The pipeline does not run on the binary files. It runs on an ASCII version of the file. To convert, use readbinary.exe. Run it with the format of 
        <p>
            readbinary.exe &lt;binary file&gt; &lt;name of output ASCII file&gt; GZ
        </p>
The name of the output ASCII file should be the name of the binary file, but with .dat replaced with .txt


</li>
<li> Configure the run. The parameters of the run are set in the mockspec.config file. There are three sections in this file. The first describes the galaxy and basic code parameters.  These are mostly self-explanatory. The      number of cores only affects the codes that can be run with parallization, namely cellfinder. The root location is not used by anything, so don't change it
    

The second section determines which codes will be run. A 1 turns the code on, a 0 turns it off. 


The third section describes the ions to be probed and what instrument will be used for that ion. 




</li>
<li> Ensure the directory has all required files, namely the galaxy file 




</li>
<li> Make all compiled codes. This includes: rates, cellfinder, los7, specsynth, sysabs, and cullabs. To make rates, you need to download and untar the following files:
<ul>
<li> <a href="http://astronomy.nmsu.edu/jrvander/ratesFiles/coolingtables.tar.gz">http://astronomy.nmsu.edu/jrvander/ratesFiles/coolingtables.tar.gz</a>
</li>
<li> <a href="http://astronomy.nmsu.edu/jrvander/ratesFiles/lapack.tar.gz">http://astronomy.nmsu.edu/jrvander/ratesFiles/lapack.tar.gz</a>
</li>
<li> <a href="http://astronomy.nmsu.edu/jrvander/ratesFiles/slatec.tar.gz">http://astronomy.nmsu.edu/jrvander/ratesFiles/slatec.tar.gz</a>
</li>
</ul>
</li>
</ol>
  

<h3>
<a id="running-the-code" class="anchor" href="#running-the-code" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running the code</h3>

<p>The main driver is mockspec.py. Run this in the directory with the snapshot. Everything is controlled by the mockspec.config file. </p>

<h3>
<a id="outputs" class="anchor" href="#outputs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Outputs</h3>

<p>The code generates several files along the way:</p>

<ul>
<li> .cellID.dat: Generated by cellfinder, this is a list of the cellIDs of cells along the LOS
</li>
<li> .dat: Generated by idcells, this contains all properties of the cells along the LOS as taken from the simulation output. 
</li>
<li> .lines: Generated by los7, this contains the column density and doppler parameter for each cell only the LOS. 
</li>
<li> .spec: Generated by specsynth, this contains the spectrum of the absorption. If the ion is a doublet, two of these files are created, one for each transition.
</li>
<li> .sysabs: Generated by sysanal, this contains the equivalent width and AOD column density of each transition. This file is only generated if absorption is detected. 
</li>
<li> .regabs: Generated by sysanal, this file is only generated if there are multiple absorption regions detected. 
</li>
<li> ALL.sysabs: Generated by cullabs, this is all sysabs files culminated into one file.  
</li>
</ul>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/jrvliet">jrvliet</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
