{"name":"Mockspec","tagline":"Full Pipeline","body":"## Welcome to Mockspec\r\nThis is the main page for the mockspec code. This code generates and analyzes synthetic quasar absorption line profiles in the circumgalactic medium around galaxies simulated with ART. It has been developed by <a href=\"http://astronomy.nmsu.edu/jrvander\">Jacob Vander Vliet</a> and <a href=\"http://astronomy.nmsu.edu/cwc>Dr. Chris Churchill</a> at <a href=\"astronomy.nmsu.edu>New Mexico State University</a>. The full details of how the code works can be found: <a href=\"http://adsabs.harvard.edu/abs/2014arXiv1409.0916C\">here</a> and <a href=\"http://adsabs.harvard.edu/abs/2015ApJ...802...10C\">here</a>. \r\n\r\n\r\n### Overview:\r\nThis code generates synthetic quasar absorption lines by running lines of sight (LOS) through a simulated galaxy made with ART.  This repository has all the code required to generate and analyze the spectra. \r\n\r\n\r\n### Before you run the code:\r\nThere are a few steps that need to be taken before the code can be run. \r\n\r\n1. To run this code, the following python packages need to be installed:\r\n+ numpy\r\n+ pytables\r\n+ pandas\r\n\r\n2. Get the simulation in the correct format. ART output the entire simulation box, typically 10Mpc along a side. Mockspec does not run on these boxes. It instead runs on a small box selected from the large box. This selection is done using ANA, a code written by Daniel Ceverino and greatly improved by Kenza Arraki. It is found in funcs/ana/. Running ANA can be challenging. It requires the following simulation files:\r\n+ 10MpcBox_HartGal_csf_a0.300.di\r\n+ 10MpcBox_HartGal_csf.d\r\n+ PMcrda0.300.DAT\r\n+ PMcrs0a0.300.DAT    \r\n+ sf.dat\r\n\r\nTo control the run of ANA, there are two control file: \r\n+ control.dat \r\n+ schedule_R.dat\r\n    \r\nSchedule_R.dat has most of the controls in it. The top section has flags as\r\nto what the code should read in and what files it should produce. The sections \r\nthat definately need to have a 1 are:\r\n+ Read N-body file\r\n+ Read stellar file\r\n+ Read HYDRO file\r\n+ Set units and global variables\r\n+ Find halo center using particle distribution\r\n+ Compute angular momentum\r\n+ density, temperature, entropy profiles and Rvir calculation\r\n+ Binary file with gas cells inside 4Rvir-box\r\n+ Binary file with gas cells inside 4Rvir-box (metalliciites)\r\n\r\nMost of the rest of the file should not be touched. ANA has an interesting behaviour where it finds the center of the galaxy, but is super bad at it. You need to find the center with Rockstar and put it in manually. The coordinates are put in on the lines \"xuser\", \"yuser\", \"zuser\". The flag in front of \"ioptCenter=1/2/3-->potential/HF/IFRIT\" should be set to 1, indicating the center is from a halo finder.\r\n\r\nTo setup control.dat, only change after the three repeated lines of \"1. 129\". The single number on the next line is the number of snapshots to run ANA on. Leave this as one. The rest of the file is the list of expansion parameters of the snapshots. Even if there are several numbers listed here, ANA will only run on the first one, since the number of snapshots to run is set to 1. \r\n\r\nOnce both control.dat and schedule_R.dat are set, run ana.R.exe.  The file needed is the GZ file. \r\n\r\n2) The pipeline does not run on the binary files. It runs on an ASCII version of the file. To convert, use readbinary.exe. Run it with the format of \r\n        \r\n            readbinary.exe <binary file> <name of output ASCII file> GZ\r\n\r\nThe name of the output ASCII file should be the name of the binary file, but with .dat replaced with .txt\r\n\r\n3) Configure the run. The parameters of the run are set in the mockspec.config file. There are three sections in this file. The first describes the galaxy and basic code parameters.  These are mostly self-explanatory. The      number of cores only affects the codes that can be run with parallization, namely cellfinder. The root location is not used by anything, so don't change it\r\n    \r\nThe second section determines which codes will be run. A 1 turns the code on, a 0 turns it off. \r\n\r\nThe third section describes the ions to be probed and what instrument will be used for that ion. \r\n\r\n4) Ensure the directory has all required files, namely the galaxy file \r\n\r\n5) Make all compiled codes. This includes: rates, cellfinder, los7, specsynth, sysabs, and cullabs. To make rates, you need to download and untar the following files:\r\n+ <a href=\"http://astronomy.nmsu.edu/jrvander/ratesFiles/coolingtables.tar.gz\">http://astronomy.nmsu.edu/jrvander/ratesFiles/coolingtables.tar.gz</a>\r\n+ <a href=\"http://astronomy.nmsu.edu/jrvander/ratesFiles/lapack.tar.gz\">http://astronomy.nmsu.edu/jrvander/ratesFiles/lapack.tar.gz</a>\r\n+ <a href=\"http://astronomy.nmsu.edu/jrvander/ratesFiles/slatec.tar.gz\">http://astronomy.nmsu.edu/jrvander/ratesFiles/slatec.tar.gz</a>\r\n\r\n  \r\n### Running the code\r\nThe main driver is mockspec.py. Run this in the directory with the snapshot. Everything is controlled by the mockspec.config file. \r\n\r\n\r\n### Outputs\r\nThe code generates several files along the way:\r\n1. .cellID.dat: Generated by cellfinder, this is a list of the cellIDs of cells along the LOS\r\n2. .dat: Generated by idcells, this contains all properties of the cells along the LOS as taken from the simulation output. \r\n3. .lines: Generated by los7, this contains the column density and doppler parameter for each cell only the LOS. \r\n4. .spec: Generated by specsynth, this contains the spectrum of the absorption. If the ion is a doublet, two of these files are created, one for each transition.\r\n5. .sysabs: Generated by sysanal, this contains the equivalent width and AOD column density of each transition. This file is only generated if absorption is detected. \r\n5. .regabs: Generated by sysanal, this file is only generated if there are multiple absorption regions detected. \r\n6. ALL.sysabs: Generated by cullabs, this is all sysabs files culminated into one file.  \r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}